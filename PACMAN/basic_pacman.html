<!DOCTYPE html>
<html>
    <head></head>
    
    <body>SCORE:
        <input id="lblScore" type="text" />
        TIME:
        <input id="lblTime" type="text" />
        Lives Left:
        <input id="LivesLeft" type="text" />
        <br/>
        <canvas id="canvas" style="border: 5px solid black;" height="740" width="740"></canvas>
        <audio id="DBGT" src="DAN DAN DBGT.mp3"></audio>
        <audio id="GameOver" src="Naruto sadness and sorrow.mp3"></audio>
        <audio id="GameWon" src="Intro.mp3"></audio>
        <button onclick="playMusic()">Play Music</button>
        <script type="text/javascript">

            var context = canvas.getContext("2d");
            //random
            var m_GhostNum = 3;
            var m_TotalBalls;
            var m_MaxTime;
            var m_PacDirection = 4;
            var shape=new Object();
            var FirstGhostPosition=new Object(); //Position of First Ghost
            var SecondGhostPosition=new Object(); //Position of Second Ghost
            var ThirdGhostPosition=new Object(); //Position of Third Ghost
            var FourthGhostPosition=new Object(); //Position of Fourth Ghost
            var bonus_pos=new Object(); 
            
            var special_pos=new Object();
            var m_special;
            var m_prev;
            var m1_prev;//if borad[][]==1 before
            var m2_prev;
            var m3_prev;

            var m_livesUser;
            var m_TimesCatched; 
            var board;
            var m_GameScore;
            var m_PacColor;
            var m_StartTime;
            var time_elapsed;    
            var interval;

            //scores for each ball
            var m_FirstBallScore = 5; 
            var m_SecondBallScore = 15; 
            var m_ThirdBallScore = 25;

            //has the game been completed
            var m_GameWon = false;
            var m_GameOver = false;

            //Game Keys Values
            var m_KeyUpUser = 38;
            var m_KeyDownUser = 40
            var m_KeyLeftUser = 37;
            var m_KeyRightUser = 39;


            
            

		Start();
            function Start() {
             playMusic();
             /*
                Movement: ArrowUp,ArrowDown,ArrowLeft,ArrowRight
                food: 90
                FirstBall Color1 num1 num1Points
                SecondBall Color2 num2 num2Points
                ThirdBall Color2 num3 num3Points
                GameTime: x seconds
                Ghosts: 3
            */
            board = new Array();
            m_GameScore = 0;
            m_TimesCatched = 0
            m_PacColor="yellow";
            var cnt = 288;
            var food_remain = 90;
            var pacman_remain = 1;
            m_livesUser = 5;
            m_StartTime= new Date();
            m_special=1;
            var m_FirstBallNum = Math.round(0.6*m_TotalBalls);
            var m_SecondBallNum= Math.round(0.3*m_TotalBalls);;
            var m_ThirdBallNum= Math.round(0.1*m_TotalBalls);;


            board = [
            [4, 4, 4, 4, 4 ,4 ,4 ,0 ,0, 4, 4, 4, 4, 4, 4, 4, 4, 4],
            [4, 3, 0, 0, 0 ,0 ,0 ,0 ,0, 0, 0, 0, 0, 0, 0, 0, 10, 4],
            [4, 0, 4, 4, 4 ,0 ,4 ,4 ,4, 0, 4, 4, 4, 0, 4, 4, 0, 4],
            [4, 0, 4, 0, 0 ,0 ,4 ,0 ,4, 0, 4, 0, 4, 0, 0, 0, 0, 4],
            [4, 0, 4, 0, 4 ,4 ,4 ,0 ,0, 0, 0, 0, 4, 4, 4, 0, 0, 4],
            [4, 0, 4, 0, 0 ,0 ,0 ,0 ,0, 0, 0, 0, 0, 0, 0, 0, 0, 4],
            [4, 0, 4, 4, 4 ,4 ,4 ,0 ,4, 0, 4, 0, 4, 4, 4, 4, 0, 4],
            [4, 0, 0, 0, 0 ,0 ,0 ,0 ,4, 0, 4, 0, 0, 0, 0, 4, 0, 4],
            [4, 0, 4, 0, 4 ,0 ,4 ,0 ,4, 0, 4, 0, 4, 4, 0, 4, 0, 4],
            [4, 0, 4, 0, 4 ,0 ,4 ,0 ,4, 0, 4, 0, 4, 0, 0, 4, 0, 4],
            [4, 0, 0, 0, 0 ,0 ,0 ,0 ,4, 0, 4, 0, 4, 0, 0, 4, 0, 4],
            [4, 0, 4, 4, 4 ,4 ,4 ,0 ,4, 0, 4, 0, 0, 0, 0, 0, 0, 4],
            [4, 0, 4, 0, 0 ,0 ,0 ,0 ,4, 0, 4, 0, 4, 4, 4, 4, 0, 4],
            [4, 0, 4, 0, 4 ,4 ,4 ,0 ,4, 0, 0, 0, 4, 0, 0, 0, 0, 4],
            [4, 0, 4, 0, 0 ,0 ,4 ,0 ,0, 0, 4, 4, 4, 0, 4, 4, 0, 4],
            [4, 0, 4, 4, 4 ,0 ,4 ,4 ,4, 0, 4, 0, 0, 0, 4, 4, 0, 4],
            [4, 6, 0, 0, 0 ,0 ,0 ,0 ,0, 0, 0, 0, 0, 0, 0, 0, 5, 4],
            [4, 4, 4, 4, 4, 4, 4, 0, 0, 4, 4, 4, 4, 4, 4, 4, 4, 4]
            ]
                        
            //Ghosts start in corners
            FirstGhostPosition.i=1;
            FirstGhostPosition.j=1;

            SecondGhostPosition.i=16;
            SecondGhostPosition.j=16;

            ThirdGhostPosition.i=16;
            ThirdGhostPosition.j=1;

            FourthGhostPosition.i=1;
            FourthGhostPosition.j=16;
            
            tempRed = Math.floor(0.6*food_remain);
            tempGreen = Math.floor(0.3*food_remain);
            tempDragon = Math.floor(0.1*food_remain);
            
            /*
            2 = pacman
            3,5,6 = ghosts
            4 = wall
            7 = redBall
            8 = GreenBall
            9 = DragonBall
            */
            for (var i = 0; i < 18; i++) { //18 is the number of rows and columns
                for (var j = 0; j < 18; j++) {
                    if(board[i][j]==4 || board[i][j]==3 || board[i][j]==5 || board[i][j]==6 || board[i][j]==10){
                        continue;
                    }
                    //place food and pacman
                    else{
                        var randomNum = Math.random();
                        if (randomNum <= 1.0 * food_remain / cnt) {
                            if(tempRed!=0){
                                board[i][j] = 7;
                                tempRed--;
                                food_remain--;
                            }
                            else if(tempRed == 0 && tempGreen!=0){
                                board[i][j] = 8;
                                tempGreen--;
                                food_remain--;
                            }
                            else if(tempRed == 0 && tempGreen==0 && tempDragon!=0){
                                board[i][j] = 9;
                                tempDragon--;
                                food_remain--;
                            }
                        } 
                        else if (randomNum < 1.0 * (pacman_remain + food_remain) / cnt) { //place pacman
                            shape.i=i;
                            shape.j=j;
                            pacman_remain--;
                            board[i][j] = 2;
                        } 
                        else {
                            board[i][j] = 0;
                        }
                        cnt--;
                    }
                }
            }

            while(food_remain > 0){
                var emptyCell = findRandomEmptyCell(board);
                if(tempRed!=0){
                    board[emptyCell[0]][emptyCell[1]] = 7;
                    tempRed--;
                    food_remain--;
                    continue;
                }
                else if(tempRed ==0 && tempGreen!=0){
                    board[emptyCell[0]][emptyCell[1]] = 8;
                    tempGreen--;
                    food_remain--;
                    continue;
                }
                else if(tempRed ==0 && tempGreen==0 && tempDragon!=0){
                    board[emptyCell[0]][emptyCell[1]] = 9;
                    tempDragon--;
                    food_remain--;
                    continue;
                }
            }
            keysDown = {};
            addEventListener("keydown", function (e) {
                keysDown[e.keyCode] = true;
            }, false);
            addEventListener("keyup", function (e) {
                keysDown[e.keyCode] = false;
            }, false);
            interval=setInterval(UpdatePosition, 150);
            interval=setInterval(UpdatePositionGhosts, 600);
                }
            
            //Find Cells For the balls
            function findRandomEmptyCell(board){
             	var i = Math.floor((Math.random() * 9) + 1);
             	var j = Math.floor((Math.random() * 9) + 1);
    			while(board[i][j]!=0 && board[i][j]!=7 && board[i][j]!=8 && board[i][j]!=9 && board[i][j]!=3 && board[i][j]!=4 && board[i][j]!=5 && board[i][j]!=4 && board[i][j]!=10)
    			{
             		i = Math.floor((Math.random() * 9) + 1);
             		j = Math.floor((Math.random() * 9) + 1);
    			}
                return [i,j];             
            }

            //Receive as input the key on which the user clicks and return value accordingly
            function GetKeyPressed() {
                //ArrowUp
                if (keysDown[m_KeyUpUser]) {
                    return 1;
                }
                //ArrowDown
                if (keysDown[m_KeyDownUser]) { 
                    return 2;
                }
                //ArrowLeft
                if (keysDown[m_KeyLeftUser]) { 
                    return 3;
                }
                //ArrowRight
                if (keysDown[m_KeyRightUser]) { 
                    return 4;
                }
            }

            //Allow the user to enter random game values
            function Randomize() {
                m_GhostNum = Math.floor(Math.random() * 4);
                m_TotalBalls = Math.floor(Math.random() * 51) + 40;
                m_MaxTime = 60 + Math.floor(Math.random() * 150);
            }


            function Draw() {
            	canvas.width=canvas.width; //clean board
                lblScore.value = m_GameScore;
                lblTime.value = time_elapsed;
                LivesLeft.value = m_livesUser;

                context.fillStyle = "black";
                context.fillRect(0, 0, canvas.width, canvas.height);
                
                for (var i = 0; i < 18; i++) {
                    for (var j = 0; j < 18; j++) {
                        var center = new Object();
                        center.x = i * 40 + 30;
                        center.y = j * 40 + 30;

                        //draw pacman
                        if (board[i][j] == 2) {
                        //UP
                            if(m_PacDirection == 1){
                                context.beginPath();
                                context.arc(center.x, center.y, 20, 1.85 * Math.PI, 1.45 * Math.PI); // half circle
                                context.lineTo(center.x, center.y);
                                context.fillStyle = m_PacColor; //color 
                                context.fill();
                                context.beginPath();
                                context.arc(center.x - 5, center.y + 13, 4, 0, 2 * Math.PI); // circle
                                context.fillStyle = "black"; //color 
                                context.fill();
                            }
                            //Down
                            if(m_PacDirection == 2){
                                context.beginPath();
                                context.arc(center.x, center.y, 20, 0.6 * Math.PI, 0.3 * Math.PI); // half circle
                                context.lineTo(center.x, center.y);
                                context.fillStyle = m_PacColor; //color 
                                context.fill();
                                context.beginPath();
                                context.arc(center.x + 5, center.y - 13, 4, 0, 2 * Math.PI); // circle
                                context.fillStyle = "black"; //color 
                                context.fill();
                            }
                            //Left
                            if(m_PacDirection == 3){
                                context.beginPath();
                                context.arc(center.x, center.y, 20, 1.15 * Math.PI, 0.85 * Math.PI); // half circle
                                context.lineTo(center.x, center.y);
                                context.fillStyle = m_PacColor; //color 
                                context.fill();
                                context.beginPath();
                                context.arc(center.x + 5, center.y - 13, 4, 0, 2 * Math.PI); // circle
                                context.fillStyle = "black"; //color 
                                context.fill();
                            }
                            //Right
                            if(m_PacDirection == 4){
                                context.beginPath();
                                context.arc(center.x, center.y, 20, 0.15 * Math.PI, 1.85 * Math.PI); // half circle
                                context.lineTo(center.x, center.y);
                                context.fillStyle = m_PacColor; //color 
                                context.fill();
                                context.beginPath();
                                context.arc(center.x + 5, center.y - 13, 4, 0, 2 * Math.PI); // circle
                                context.fillStyle = "black"; //color 
                                context.fill();
                            }
                        }
                        //draw foods
                        else if (board[i][j] == 7) {
                            context.beginPath();
                            context.arc(center.x, center.y, 10, 0, 2 * Math.PI); // circle
                            context.fillStyle = "red"; //color 
                            context.fill();
                        }
                        else if (board[i][j] == 8) {
                            context.beginPath();
                            context.arc(center.x, center.y, 10, 0, 2 * Math.PI); // circle
                            context.fillStyle = "green"; //color 
                            context.fill();
                        }
                        else if (board[i][j] == 9) {
                            context.beginPath();
                            context.arc(center.x, center.y, 10, 0, 2 * Math.PI); // circle
                            context.fillStyle = "orange"; //color 
                            context.fill();
                        }
                        //draw Ghost1
                        else if (board[i][j] == 3) {
                            base_image = new Image();
                            base_image.src = 'ghost1.png';
                            context.drawImage(base_image, center.x-20, center.y-20, 40, 40);
                        }
                        //draw Wall
                        else if (board[i][j] == 4) {

                            base_image = new Image();
                            base_image.src = 'wall7.png';
                            context.drawImage(base_image, center.x-20, center.y-20, 40, 40);
                        }
                        //draw Ghost2
                        else if (board[i][j] == 5) {
                            base_image = new Image();
                            base_image.src = 'ghost2.png';
                            context.drawImage(base_image, center.x-20, center.y-20, 40, 40);
                        }
                        //draw Ghost3
                        else if (board[i][j] == 6) {
                            base_image = new Image();
                            base_image.src = 'ghost3.png';
                            context.drawImage(base_image, center.x-20, center.y-20, 40, 40);
                        }
                        //draw Ghost4
                        else if (board[i][j] == 10) {
                        console.log("I am Here")
                        base_image = new Image();
                        base_image.src = 'ghost4.png';
                        context.drawImage(base_image, center.x-20, center.y-20, 40, 40);
                        }
                    }
                }
            }

            //Makes the ghosts chase Pacman
            function UpdatePositionGhosts(){
                //Ghost1: 3, Ghost2:5, Ghost3:6, Ghost4:10
                if(m_GhostNum ==1){
                    FirstGhostMovement();
                }
                if(m_GhostNum ==2){
                    FirstGhostMovement();
                    SecondGhostMovement();
                }
                if(m_GhostNum ==3){
                    FirstGhostMovement();
                    SecondGhostMovement();
                    ThirdGhostMovement();
                }
                if(m_GhostNum ==4){
                    FirstGhostMovement();
                    SecondGhostMovement();
                    ThirdGhostMovement();
                    FourthGhostMovement();
                }
                if(m_prev==2){
                    m_prev=0;
                }
            }

            /* Update the position of pacman according
            to what key has been pressed
            */
            function UpdatePosition() {
            	board[shape.i][shape.j]=0;
                var x = GetKeyPressed()
                //Move Pacman Up
                if(x==1)
                {
                	if(shape.j>0 && board[shape.i][shape.j-1]!=4)
                	{
                		shape.j--;
                        m_PacDirection = 1;
                	}
                }
                //Move Pacman Down
                if(x==2)
                {
                	if(shape.j<17 && board[shape.i][shape.j+1]!=4)
                	{
                		shape.j++;
                        m_PacDirection = 2;
                	}
                }
                //Move Pacman To The Right
                if(x==3)
                {
                	if(shape.i>0 && board[shape.i-1][shape.j]!=4)
                	{
                		shape.i--;
                        m_PacDirection = 3;
                	}
                }
                //Move Pacman To The Left
                if(x==4)
                {
                	if(shape.i<17 && board[shape.i+1][shape.j]!=4)
                	{
                		shape.i++;
                        m_PacDirection = 4;
                	}
                }
                //Pacman moves to a place where there is food
                if(board[shape.i][shape.j]==7)
                {
                	m_GameScore = m_GameScore + m_FirstBallScore;
                }
                if(board[shape.i][shape.j]==8)
                {
                	m_GameScore = m_GameScore + m_SecondBallScore;
                }
                if(board[shape.i][shape.j]==9)
                {
                	m_GameScore = m_GameScore + m_ThirdBallScore;
                }
                board[shape.i][shape.j]=2; //Draw pacman in his new position
                var currentTime=new Date();
                time_elapsed=(currentTime-m_StartTime)/1000;

                /*
                In case of a ghost catching pacman
                */
                if((shape.i==FirstGhostPosition.i && shape.j==FirstGhostPosition.j) || (shape.i==SecondGhostPosition.i && shape.j==SecondGhostPosition.j) || ((shape.i==ThirdGhostPosition.i && shape.j==ThirdGhostPosition.j))){
                    board[shape.i][shape.j] = 0;
                    board[FirstGhostPosition.i][FirstGhostPosition.j] = 0;
                    m_GameScore-=10;
                    m_TimesCatched++;
                    m_livesUser--;
                    FirstGhostPosition.i=1;
                    FirstGhostPosition.j=1;
                    board[FirstGhostPosition.i][FirstGhostPosition.j] = 3;
                    var emptyCell = findRandomEmptyCell(board);
                    shape.i=emptyCell[0];
                    shape.j=emptyCell[1];
                    if(m_livesUser==0){
                        window.clearInterval(interval);
                        window.alert("Game lost");
                        m_GameOver = true;
                        playMusic();
                    }
                }

            	if(m_GameScore>=20&&time_elapsed<=10)
            	{
            		m_PacColor="green";
            	}
            	if(m_GameScore==(150-10*m_TimesCatched))
            	{
            		window.clearInterval(interval);
            		window.alert("Game completed");
                    m_GameWon = true;
                    playMusic();
            	}
            	else
            	{
            		Draw();
            	}
            }
            // document.addEventListener('DOMContentLoaded', (event) => {
            //     Start();
            // });
            function playMusic() {
            if(m_GameOver == false && m_GameWon ==false){
                var dbgt_audio = document.getElementById("DBGT");
                dbgt_audio.play();
            }
            if(m_GameOver == true){
                dbgt_audio.pause();
                var GameOverAudio = document.getElementById("GameOver");
                GameOverAudio.play();
            }
            if(m_GameWon == true){
                dbgt_audio.pause();
                var GameWonAudio = document.getElementById("GameWon");
                GameWonAudio.play();
            }

                }

            function FirstGhostMovement(){
                if(FirstGhostPosition.i < shape.i && board[FirstGhostPosition.i+1][FirstGhostPosition.j]!=4 && board[FirstGhostPosition.i+1][FirstGhostPosition.j]!=5 && board[FirstGhostPosition.i+1][FirstGhostPosition.j]!=6 && board[FirstGhostPosition.i+1][FirstGhostPosition.j]!=10) {
                        board[FirstGhostPosition.i][FirstGhostPosition.j] = m_prev;
                        m_prev = board[FirstGhostPosition.i+1][FirstGhostPosition.j];
                        FirstGhostPosition.i++;
                        board[FirstGhostPosition.i][FirstGhostPosition.j]=3;
                }
                else if(FirstGhostPosition.j < shape.j && board[FirstGhostPosition.i][FirstGhostPosition.j+1]!=4 && board[FirstGhostPosition.i+1][FirstGhostPosition.j]!=5 && board[FirstGhostPosition.i+1][FirstGhostPosition.j]!=6 && board[FirstGhostPosition.i+1][FirstGhostPosition.j]!=10){
                    board[FirstGhostPosition.i][FirstGhostPosition.j] = m_prev;
                    m_prev = board[FirstGhostPosition.i][FirstGhostPosition.j+1];
                    FirstGhostPosition.j++;
                    board[FirstGhostPosition.i][FirstGhostPosition.j]=3;
                }
                else if(FirstGhostPosition.i > shape.i){
                    if(board[FirstGhostPosition.i-1][FirstGhostPosition.j]!=4 && board[FirstGhostPosition.i+1][FirstGhostPosition.j]!=5 && board[FirstGhostPosition.i+1][FirstGhostPosition.j]!=6 && board[FirstGhostPosition.i+1][FirstGhostPosition.j]!=10){
                        board[FirstGhostPosition.i][FirstGhostPosition.j] = m_prev;
                        m_prev = board[FirstGhostPosition.i-1][FirstGhostPosition.j];
                        FirstGhostPosition.i--;
                        board[FirstGhostPosition.i][FirstGhostPosition.j]=3;
                    }
                }
            }

            function SecondGhostMovement(){
                return 1;
            }

            function ThirdGhostMovement(){
                return 1;
            }

            function FourthGhostMovement(){
                return 1;
            }

            /**
             *     public boolean legalMove(String direction)
    {
        int thisRow = playerRow;
        int thisCol = playerCol;

        if(direction.equals("up"))
        {
            if((thisRow - 1 < 0) || (maze.getMazeArr()[thisRow - 1][thisCol] == 1))
                return false;
        }
        else if (direction.equals("up right"))
        {
            if((thisRow - 1 < 0) || (thisCol + 1 >= maze.getMax_columns()) || (maze.getMazeArr()[thisRow - 1][thisCol + 1] == 1))
                return false;
            if((maze.getMazeArr()[thisRow - 1][thisCol] == 1) && (maze.getMazeArr()[thisRow][thisCol + 1] == 1))
                return false;
        }
        else if (direction.equals("right"))
        {
            if((thisCol + 1 >= maze.getMax_columns()) || (maze.getMazeArr()[thisRow][thisCol + 1] == 1))
                return false;
        }
        else if (direction.equals("down right"))
        {
            if((thisRow + 1 >= maze.getMax_rows()) || (thisCol + 1 >= maze.getMax_columns()) || (maze.getMazeArr()[thisRow + 1][thisCol + 1] == 1))
                return false;
            if((maze.getMazeArr()[thisRow + 1][thisCol] == 1) && (maze.getMazeArr()[thisRow][thisCol + 1] == 1))
                return false;
        }
        else if (direction.equals("down"))
        {
            if((thisRow + 1 >= maze.getMax_rows()) || (maze.getMazeArr()[thisRow + 1][thisCol] == 1))
                return false;
        }
        else if (direction.equals("down left"))
        {
            if((thisRow + 1 >= maze.getMax_rows()) || (thisCol - 1 < 0) || (maze.getMazeArr()[thisRow + 1][thisCol - 1] == 1))
                return false;
            if((maze.getMazeArr()[thisRow + 1][thisCol] == 1) && (maze.getMazeArr()[thisRow][thisCol - 1] == 1))
                return false;
        }
        else if (direction.equals("left"))
        {
            if((thisCol - 1 < 0) || (maze.getMazeArr()[thisRow][thisCol - 1] == 1))
                return false;
        }
        else if (direction.equals("up left"))
        {
            if((thisRow - 1 < 0) || (thisCol - 1 < 0) || (maze.getMazeArr()[thisRow - 1][thisCol - 1] == 1))
                return false;
            if((maze.getMazeArr()[thisRow - 1][thisCol] == 1) && (maze.getMazeArr()[thisRow][thisCol - 1] == 1))
                return false;
        }

        return true;
    }
            */
        </script>

        
    
    </body>
    
</html>